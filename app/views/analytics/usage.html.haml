- content_for :after_title, ' - Usage Stats'
= hot_javascript_tag("charts")

%header.main-page
  .container
    %h1 Usage Stats

.container.usage-stats-page
  %section.module
    .section-header
      %h2 Overview Statistics
    = render 'overview_stats'

  %section.module
    .section-header
      %h2 Courses / Programs Over Time
    = render 'courses_over_time'

  %section.module
    .section-header
      %h2 Yearly Statistics
      %p.subtitle (by program creation date)
    = render 'yearly_stats'

  %section.module
    .section-header
      %h2 Wiki Activity Overview
    = render 'wiki_activity_stats'

  %section.module
    .section-header
      %h2 Wiki List
      %p.subtitle= "#{@wiki_data[:summary][:total_wikis]} wikis with #{@wiki_data[:summary][:total_courses]} courses total"
    = render 'wiki_list'

  %section.module
    .section-header
      %a.button.dark#csv-btn{href: '/all_courses_csv'} Generate CSV of all programs
      
      %a.button.dark{href: '/all_courses_and_instructors_csv'} Generate CSV of all courses and instructors

  :javascript
    document.addEventListener("click", function (e) {
      const btn = e.target.closest("#csv-btn");
      if (!btn) return;

      if (btn.dataset.locked === "true") {
        e.preventDefault();
        return;
      }

      btn.dataset.locked = "true";
      btn.textContent = "Generating CSV. This may take a while...";
      btn.style.pointerEvents = "none";
      btn.style.opacity = "0.6";

      setTimeout(function () {
        btn.dataset.locked = "false";
        btn.textContent = "Generate CSV of all programs";
        btn.style.pointerEvents = "";
        btn.style.opacity = "";
      }, 300000);
    });
