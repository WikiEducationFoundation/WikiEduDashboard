- content_for :before_title, t("#{@presenter.course_string_prefix}.campaign_courses", title: @campaign.title) + ' â€” '

#react_root{data: {slug: @campaign.slug}}

.container
  %section#courses
    .section-header
      %h3
        = t("#{@presenter.course_string_prefix}.campaign_courses", title: @campaign.title)
      = form_tag programs_campaign_path(@campaign.slug, anchor: 'courses_table'), method: :get, accept_charset: 'UTF-8', id: 'campaign_search_form', onsubmit: 'this.action = this.action.replace(/#.*$/, "") + "#courses_table";' do
        .form-fields
          .form-row
            = text_field_tag :title_query, params[:title_query], placeholder: t('form_search.search') + ' ' + t('courses.title'), id: 'title_query', style: 'width: 100%'
          .form-row
            %button.button{type: 'button', onclick: 'var el=document.getElementById("advanced_search_fields"); var expanded=this.getAttribute("aria-expanded")==="true"; this.setAttribute("aria-expanded", (!expanded).toString()); el.style.display = expanded ? "none" : "block";'}= t('form_search.advanced_search')
          .advanced-search#advanced_search_fields{style: 'display:none;'}
            .form-row{style: 'display: grid; grid-template-columns: 180px 1fr 80px 1fr; column-gap: 10px; align-items: center;'}
              %label{for: 'school_select'}= t('courses.school')
              = select_tag :school, options_for_select(@presenter.school_options, params[:school]), include_blank: true, id: 'school_select', style: 'grid-column: 2 / span 3;'
            .form-row{style: 'display: grid; grid-template-columns: 180px 1fr 60px 1fr; column-gap: 10px; align-items: center;'}
              %label{for: 'creation_start'}= t("courses.creation_date") + ' ' + t('form_search.between')
              = date_field_tag :creation_start, params[:creation_start], id: 'creation_start', style: 'width: 60%'
              %label{for: 'creation_end'}= t('form_search.and')
              = date_field_tag :creation_end, params[:creation_end], id: 'creation_end', style: 'width: 60%'
            .form-row{style: 'display: grid; grid-template-columns: 180px 1fr 60px 1fr; column-gap: 10px; align-items: center;'}
              %label{for: 'start_date_start'}= t("courses.start_date") + ' ' + t('form_search.between')
              = date_field_tag :start_date_start, params[:start_date_start], id: 'start_date_start', style: 'width: 60%'
              %label{for: 'start_date_end'}= t('form_search.and')
              = date_field_tag :start_date_end, params[:start_date_end], id: 'start_date_end', style: 'width: 60%'
            .form-row{style: 'display: grid; grid-template-columns: 180px 1fr 60px 1fr; column-gap: 10px; align-items: center;'}
              %label{for: 'revisions_min'}= t("metrics.revisions") + ' ' + t('form_search.between')
              = number_field_tag :revisions_min, params[:revisions_min], id: 'revisions_min', min: 0, style: 'width: 60%'
              %label{for: 'revisions_max'}= t('form_search.and')
              = number_field_tag :revisions_max, params[:revisions_max], id: 'revisions_max', min: 0, style: 'width: 60%'
            .form-row{style: 'display: grid; grid-template-columns: 180px 1fr 60px 1fr; column-gap: 10px; align-items: center;'}
              %label{for: 'word_count_min'}= t("metrics.word_count") + ' ' + t('form_search.between')
              = number_field_tag :word_count_min, params[:word_count_min], id: 'word_count_min', min: 0, style: 'width: 60%'
              %label{for: 'word_count_max'}= t('form_search.and')
              = number_field_tag :word_count_max, params[:word_count_max], id: 'word_count_max', min: 0, style: 'width: 60%'
            .form-row{style: 'display: grid; grid-template-columns: 180px 1fr 60px 1fr; column-gap: 10px; align-items: center;'}
              %label{for: 'references_min'}= t("metrics.references_count") + ' ' + t('form_search.between')
              = number_field_tag :references_min, params[:references_min], id: 'references_min', min: 0, style: 'width: 60%'
              %label{for: 'references_max'}= t('form_search.and')
              = number_field_tag :references_max, params[:references_max], id: 'references_max', min: 0, style: 'width: 60%'
            .form-row{style: 'display: grid; grid-template-columns: 180px 1fr 60px 1fr; column-gap: 10px; align-items: center;'}
              %label{for: 'views_min'}= t("metrics.view") + ' ' + t('form_search.between')
              = number_field_tag :views_min, params[:views_min], id: 'views_min', min: 0, style: 'width: 60%'
              %label{for: 'views_max'}= t('form_search.and')
              = number_field_tag :views_max, params[:views_max], id: 'views_max', min: 0, style: 'width: 60%'
            .form-row{style: 'display: grid; grid-template-columns: 180px 1fr 60px 1fr; column-gap: 10px; align-items: center;'}
              %label{for: 'users_min'}= t("users.editors") + ' ' + t('form_search.between')
              = number_field_tag :users_min, params[:users_min], id: 'users_min', min: 0, style: 'width: 60%'
              %label{for: 'users_max'}= t('form_search.and')
              = number_field_tag :users_max, params[:users_max], id: 'users_max', min: 0, style: 'width: 60%'
        .form-actions
          %button.button{type: 'submit'}= t('campaign.search')
          %button.button.button--clear{type: 'button', onclick: 'document.getElementById("title_query").value=""; document.getElementById("creation_start").value=""; document.getElementById("creation_end").value=""; document.getElementById("start_date_start").value=""; document.getElementById("start_date_end").value=""; document.getElementById("school_select").value=""; document.getElementById("revisions_min").value=""; document.getElementById("revisions_max").value=""; document.getElementById("word_count_min").value=""; document.getElementById("word_count_max").value=""; document.getElementById("references_min").value=""; document.getElementById("references_max").value=""; document.getElementById("views_min").value=""; document.getElementById("views_max").value=""; document.getElementById("users_min").value=""; document.getElementById("users_max").value=""; this.form.action = this.form.action.replace(/#.*$/, "") + "#courses_table"; this.form.submit();'}= t('form_search.clear')
      .sort-select
        %select.sorts{rel: 'courses'}
          %option{rel: 'asc', value: 'title'}
            = t("courses.title")
          %option{rel: 'asc', value: 'school'}
            = t("courses.school")
          %option{rel: 'desc', value: 'revisions'}
            = t("metrics.revisions")
          %option{rel: 'desc', value: 'characters'}
            = t("metrics.word_count")
          %option{rel: 'desc', value: 'average-words'}
            = t("metrics.word_count_average")
          %option{rel: 'desc', value: 'references'}
            = t("metrics.references_count")
          %option{rel: 'desc', value: 'views'}
            = t("metrics.view")
          %option{rel: 'desc', value: 'students'}
            = t("users.editors")
          %option{rel: 'desc', value: 'untrained'}
            = t("courses.untrained")
          - unless Features.wiki_ed?
            %option{rel: 'desc', value: 'creation-date'}
              = t("courses.creation_date")
          %option{rel: 'asc', value: 'start-date'}
            = t("courses.start_date")

    %table.table.table--hoverable.table--sortable{ id: 'courses_table' }
      %thead
        %tr
          %th.sort.sortable{'data-default-order' => 'asc', 'data-sort' => 'title'}
            = t("#{@presenter.course_string_prefix}.courses")
            %span.sortable-indicator
          %th.sort.sortable{style: 'width: 200px;', 'data-default-order' => 'asc', 'data-sort' => 'school'}
            = t("#{@presenter.course_string_prefix}.school_and_term")
            %span.sortable-indicator
          - if Features.wiki_ed?
            %th Instructor
          %th.sort.sortable.desc{style: 'width: 165px;', 'data-default-order' => 'desc', 'data-sort' => 'revisions'}
            .tooltip-trigger
              = t('metrics.revisions')
              %span.sortable-indicator
              %span.tooltip-indicator
              .tooltip.dark
                %p= t('courses.revisions_doc', timeframe: RevisionStatTimeslice::REVISION_WINDOW_DAYS)
          %th.sort.sortable{style: 'width: 172px;', 'data-default-order' => 'desc', 'data-sort' => 'characters'}
            .tooltip-trigger
              = t('metrics.word_count')
              %span.sortable-indicator
              %span.tooltip-indicator
              .tooltip.dark
                %p= course_i18n('word_count_doc')
          %th.sort.sortable{style: 'width: 172px;', 'data-default-order' => 'desc', 'data-sort' => 'references'}
            .tooltip-trigger
              = t('metrics.references_count')
              %span.sortable-indicator
              %span.tooltip-indicator
              .tooltip.dark
                %p= t('metrics.references_doc')
          %th.sort.sortable{style: 'width: 125px;', 'data-default-order' => 'desc', 'data-sort' => 'views'}
            .tooltip-trigger
              = t('metrics.view')
              %span.sortable-indicator
              %span.tooltip-indicator
              .tooltip.dark
                %p= t('courses.view_doc')
          %th.sort.sortable{style: 'width: 200px;', 'data-default-order' => 'desc', 'data-sort' => 'students'}
            = t('users.editors')
            %span.sortable-indicator
          - unless Features.wiki_ed?
            %th.sort.sortable{'data-default-order' => 'desc', 'data-sort' => 'creation-date', style: 'width: 160px'}
              = t('courses.creation_date')
              %span.sortable-indicator

          %th.sort.sortable{style: 'width: 160px;', 'data-default-order' => 'desc', 'data-sort' => 'start-date'}
            = t('courses.start_date')
            %span.sortable-indicator
          
          - if @presenter.can_remove_course?
            %th{style: 'width:100px'}
              = t('courses.actions')
      %tbody.list
        - if @search_terms.present?
          - if @results.count > 1
            %h4= t('application.search_results.other', search_terms: @search_terms, count: @results.count)
          -else
            %h4= t('application.search_results.one', search_terms: @search_terms, count: @results.count)
          - @results.each do |c|
            = render 'campaigns/course_row', course: c, admin: false, user: false
        - else
          - programs = @presenter.courses_by_recent_edits
          = will_paginate programs
          - programs.each do |course|
            - cache [course, locale, @presenter.can_remove_course?]  do
              = render 'campaigns/course_row', course: course, admin: false, user: false
